{"title":"Main Analysis","markdown":{"yaml":{"title":"Main Analysis","toc":true,"number-sections":true,"format":{"html":{"code-fold":true}},"jupyter":"python3"},"headingText":"Sample Data","containsRefs":false,"markdown":"\n\n\n```{python}\nimport pandas as pd\nimport numpy as np\nimport requests\nfrom pandas import Series, DataFrame\nimport matplotlib.pyplot as plt\nfrom matplotlib import rcParams\nimport statsmodels.api as sm\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport plotly.express as px\nimport plotly.graph_objs as go\nplt.rc('font', size=10)\n%matplotlib inline\n```\n\n\n\n```{python}\nvaccine_df = pd.read_csv(\"dataset/country_vaccinations.csv\")\nvaccine_df.head(5)\n```\n\n\n```{python}\nsummary_df = pd.read_csv(\"dataset/worldometer_coronavirus_summary_data.csv\")\nsummary_df.head(5)\n```\n\n```{python}\nsummary_df.info()\n```\n\n```{python}\ndaily_df = pd.read_csv(\"dataset/worldometer_coronavirus_daily_data.csv\")\ndaily_df.head(5)\n```\n\n```{python}\ndef aggregate(df: pd.Series, agg_col: str) -> pd.DataFrame:\n\n    data = df.groupby(\"country\")[agg_col].max()\n    data = pd.DataFrame(data)\n\n    return data\nprint([x for x in vaccine_df.country.unique() if x not in summary_df.country.unique()])\n```\n\n```{python}\nprint([x for x in vaccine_df.country.unique() if x not in summary_df.country.unique()])\n```\n\n```{python}\nvaccine_df.country = vaccine_df.country.replace().replace({\n    \"Czechia\": \"Czech Republic\", \n    \"United States\": \"USA\", \n    \"United Kingdom\": \"UK\", \n    \"Isle of Man\": \"Isle Of Man\",\n    \"Republic of Ireland\": \"Ireland\",\n    \"Northern Cyprus\" : \"Cyprus\"\n})\n \n#These 4 countries are a part of UK\nvaccine_df = vaccine_df[vaccine_df.country.apply(lambda x: x not in ['England', 'Scotland', 'Wales', 'Northern Ireland'])]\n```\n\n# Setting\n\nIn the following Analysis we  examine how effective Covid-19 vaccines are at protecting people against risk of dying from Covid-19. Vaccine effectiveness have shown that receiving 2-3 doses of COVID-19 vaccine can reduce severe COVID-19 outcomes. A study that looked at outcomes among hospitalized patients during March - June 2022 found that Covid-19 was associated with a 90% reduction in risk for severe Covid-19 outcomes, including invasive mechanical ventilation and in-hospital deaths across variant periods.Vaccinated people who died were likely to be older, more likely to be immunocompromised and had more chronic medical conditions compared with unvaccinated case-patients.\n\n\n# Death Rate Analysis\n\n```{python}\npx.scatter(summary_df.head(20), x='continent',y='total_deaths',\n           hover_data=['country', 'continent'],\n           color='total_deaths', size='total_deaths', size_max=40, log_y=True)\n```\n\n- The graph shows that the continent with the most Covid-19 related deaths is South America, followed by Europe then Asia. \n- North America had the least number of deaths.\n \n- On 13 May 2020, it was reported that Latin America and the Caribbean had reported over 400,000 cases of COVID-19 infection with, 23,091 deaths. On 22 May 2020, citing the rapid - - increase of infections in Brazil, the World Health Organization declared South America the epicentre of the pandemic.[4][5]\n \n- As of 16 July 2021, South America had recorded 34,359,631 confirmed cases and 1,047,229 deaths from COVID-19. Due to a shortage of testing and medical facilities, it is believed that the outbreak is far larger than the official numbers show.\n \n\nReference: https://en.wikipedia.org/wiki/COVID-19_pandemic_in_South_America\n\n\n# Death rate by Country \n\n```{python}\n# Country wise deaths\npx.bar(summary_df,x=\"country\", y=\"total_deaths\", height=400)\n```\n\n```{python}\n#We will create an aggregated dataset by aggreagting the required columns using previous function.\nsummary_cols = ['people_vaccinated', \n                     'people_vaccinated_per_hundred', \n                     'people_fully_vaccinated', \n                     'people_fully_vaccinated_per_hundred', \n                     'total_vaccinations_per_hundred', \n                     'total_vaccinations']\n \nsummary = summary_df.set_index(\"country\")\nvaccines = vaccine_df[['country', 'vaccines']].drop_duplicates().set_index('country')\nsummary = summary.join(vaccines)\n \nfor col in summary_cols:   \n   summary = summary.join(aggregate(vaccine_df, col))\n \n#Two aditional columns for better understanding\nsummary['percentage_vaccinated'] = summary.people_vaccinated / summary.population * 100\nsummary['tested_positive'] = summary.total_confirmed / summary.total_tests * 100\n```\n\n```{python}\npx.scatter(summary, x=\"people_fully_vaccinated\", y=\"total_deaths\", height=400)\n```\n\n\n- The top 5 countries with the highest deaths are USA, Brazil, India, Mexico and Russia . from the below plot we can see.. that in the 0 people_fully_vaccinated, shows much deaths\n\n\n```{python}\nvaccinated_vs_deaths = summary[[\"people_fully_vaccinated\", \"total_deaths\"]].reset_index()\npx.scatter(vaccinated_vs_deaths, x=\"people_fully_vaccinated\", y=\"total_deaths\", height=400, color = \"country\")\n```\n\n\nThe scattter plot shows that more deaths were recorded for countries with less vaccinations.\n- For example USA had 217M people vaccinated and recorded one of the highest death rate values, whereas China has over 1.2b people vaccinated and fewer deaths recorded.\n\n\n```{python}\npx.choropleth(vaccine_df,\n              locations=\"iso_code\",\n              color=\"people_vaccinated\",\n              hover_name=\"country\",\n              color_continuous_scale=\"Blues\",\n              animation_frame=\"date\")\n```\n\nPress play on the map key to see the changes of Vccination rates in different countries as it changed over time\n\n\n```{python}\ndef fill_title_and_subtitle(title:str, subtitle:str):\n    return f\"{title}<br><sub>{subtitle}</sub>\"\n \ndef create_bar_chart(data: pd.DataFrame, xcolumn: str, ycolumn:str, title:str, colors:str, ylabel=\"Count\", n=None):\n    hovertemplate ='<br><b>%{x}</b>'+f'<br><b>{ylabel}: </b>'+'%{y}<br><extra></extra>'    \n    data = data.sort_values(ycolumn, ascending=False).dropna(subset=[ycolumn])        \n\n    if n is not None: \n        data = data.iloc[:n]\n    else:\n        n = \"\"\n    fig = go.Figure(go.Bar(\n                    hoverinfo='skip',\n                     x=data[xcolumn], \n                     y=data[ycolumn], \n                     hovertemplate = hovertemplate,\n                     marker=dict(\n                         color = data[ycolumn],\n                         colorscale=colors,\n                        ),\n                    ),\n                )\n\n    fig.update_layout(\n        title=title,\n        xaxis_title=f\"Top {n} {xcolumn.title()}\",\n        yaxis_title=ylabel,\n        plot_bgcolor='rgba(0,0,0,0)',\n        hovermode=\"x\"\n    )\n\n    fig.show()\n```\n\n```{python}\ntitle = fill_title_and_subtitle(\"Total Deaths\", \"Countries with Highest Percentages of total deaths\")\n# create_bar_chart(summary.reset_index(), 'country', \"total_vaccinations\", title, \"viridis\", n=20 )\ntitle =(\"Total Vaccinated\")\ncreate_bar_chart(summary.reset_index(), 'country', \"total_vaccinations\", title, \"viridis\", n=20 )\n```\n\n\n- The above graph shows that top 5 vaccinated countries are China, India, USA, Brazil and Indonesia.\n- Its very interesting, to see that China where the pandemic started is also the country with the most people vaccinated.\n\n```{python}\ntitle = fill_title_and_subtitle(\"Total Deaths\", \"Countries with Highest Percentages of total deaths\")\ncreate_bar_chart(summary.reset_index(), 'country', \"total_deaths\", title, \"twilight\", n=20 )\n```\n\nThe countries with the most deaths are USA, Brazil, India and Russia\n\n```{python}\ntitle = fill_title_and_subtitle(\"Percentage Vaccinated\", \"Countries with Highest Percentages of total population\")\ncreate_bar_chart(summary.reset_index(), 'country', \"percentage_vaccinated\", title, \"Blugrn\", n=20 )\n```\n\n\nIt is better to merge the Vaccination(vaccine_df) and Daily Cases (summary_df) datasets. Before combining, an aggregate of each column must be created to have aggregate data (In vaccine dataset, as noticed above, data is present for each country on each date.)\n\n```{python}\ndata = summary.dropna(subset=['serious_or_critical'])\ndata = data.reset_index()\ntitle = fill_title_and_subtitle(\"Serious or Critical Cases\", \"Number of people who are currently critically ill due to Covid-19\")\ncreate_bar_chart(data, 'country',\"serious_or_critical\", title, \"turbid\", n=20)\n```\n\nCountries with top critical cases are Brazil, Mexico and  Indonesia\n\n```{python}\ntitle = (\"Death Rates\")\ndata = summary_df.copy()\ndata['death_rate'] =  (data['total_deaths']/data['total_confirmed'])*100\ndata = data.dropna(subset=['death_rate'])\nfig = px.scatter_geo(data, locations=\"country\", color=\"continent\",\nlocationmode='country names',\nhover_name=\"country\", size=\"death_rate\",\nprojection=\"natural earth\")\nfig.update_layout(title=title, title_x=0.45)\nfig.show()\n```\n\n# Understanding Covid-19 vaccination with respect to time\n\n```{python}\nimport math\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n# unique dates \ndates = vaccine_df.date.unique().tolist()\n#For more smoother animations\ndates.extend(['2020-12-12', '2020-12-13']) \n \n# unique countries \ncountries = vaccine_df.country.unique().tolist()\n \n# for easy processing \nshort = vaccine_df[['date', 'country', 'total_vaccinations']]\n \n# values of unqiue (date, country) already in short \n# i.e we want to make sure we have some data for each, even if it is 0 \nkeys= list(zip(short.date.tolist(), short.country.tolist()))\nfor date in dates:\n    for country in countries:\n        idx = (date, country)\n        if idx not in keys:\n            if date == min(dates):\n                # this means there's no entry for {country} on the earliest date \n                short = short.append({\n                    \"date\": date, \n                    \"country\": country, \n                    \"total_vaccinations\": 0\n                }, ignore_index=True)\n            else:\n                # entry for {country} is missing on a date other than the earliest\n                short = short.append({\n                    \"date\": date, \n                    \"country\": country, \n                    \"total_vaccinations\": pd.NA\n                }, ignore_index=True)\n\n#fill missing values with previous day values (this is OK since it is cumulative)\nshort = short.sort_values(['country', 'date'])\n \nshort.total_vaccinations = short.total_vaccinations.fillna(method='ffill')\n \n# scale the number by log to make the color transitions smoother\nvaccines = short.sort_values('date')\nvaccines['log_scale'] = vaccines['total_vaccinations'].apply(lambda x : math.log2(x+1))\n```\n\n- China had the highest vaccination rates despite being the centre of the pandemc outbreak.\n- In other countries the rate seems to be lagging  a little bit.\n\n```{python}\ncountries = short.groupby('country')['total_vaccinations'].max().sort_values(ascending=False)[:10].index.tolist()\n\ntitle = fill_title_and_subtitle(\"Vaccination Progress\", \"Rate of vaccination for top-10 vaccinated countries\")\n\n#title = (\"Vaccination Progress\") \nline_plots = []\n\nfor c in countries:\n    vacc_data = short[short.country == c]\n    line_plots.append(\n        go.Scatter(\n            name = c,\n            x = vacc_data.date,\n            mode='lines+markers',\n            y=vacc_data['total_vaccinations'],\n            )\n        )\n\nfig = go.Figure(line_plots)\n\nfig.update_layout(\n    title =title,\n    yaxis_title=\"Count\",\n    hovermode='x',\n    legend_orientation='h')\n```\n\n# Cumulative Statistics \n\n```{python}\nfrom datetime import datetime\nvaccs=vaccine_df.copy()\ndaily=daily_df.copy()\ndaily.head()\n# standardise the dates \nvaccs.date =vaccs.date.apply(lambda x: datetime.strptime(x, \"%Y-%m-%d\"))\ndaily.date =daily.date.apply(lambda x: datetime.strptime(x, \"%Y-%m-%d\"))\n \n# use only common countries and dates \ncountries = vaccs.dropna(subset=['daily_vaccinations'])['country'].unique()\ndates = vaccs.dropna(subset=['daily_vaccinations'])['date'].unique()\ncountry_mask = daily.country.apply(lambda x: x in countries)\ndate_mask = daily.date.apply(lambda x: x in dates)\n \n# generate the visualization data \ncolumns_to_sum = ['daily_new_cases', 'cumulative_total_cases', 'cumulative_total_deaths', 'active_cases']\ndaily_cases = daily[country_mask & date_mask].groupby('date')[columns_to_sum].sum()\ndaily_vaccs = vaccs.groupby('date')[[ 'daily_vaccinations']].sum()\n \n# make it a dataframe for convenience  \ndata = pd.DataFrame(daily_cases).join(pd.DataFrame(daily_vaccs))\n \n# bring back the vaccine data we prepared in the previous section \ncumulative_vaccines = pd.DataFrame(vaccines.groupby('date')['total_vaccinations'].sum())\ndata = data.join(cumulative_vaccines).reset_index()\n```\n\n\n# Vaccination vs Cases \n```{python}\ntitle = fill_title_and_subtitle(\"Vaccine vs Virus\", \"Comparing the total number of daily new cases and daily vaccinations globally\")\nfig = go.Figure(data=[\n                go.Bar(\n                    name=\"New Cases\",\n                    x=data['date'], \n                    y=data['daily_new_cases'],\n                    marker_color=\"crimson\",\n                ),\n                go.Bar(\n                    name=\"Vaccinated\",\n                    x=data['date'], \n                    y=data['daily_vaccinations'],\n                    marker_color=\"lightseagreen\"\n                ),\n \n            ])\n \nfig.update_layout(\n        title=title,\n        xaxis_title=\"Date\",\n        yaxis_title=\"Count\",\n        plot_bgcolor='rgba(0,0,0,0)',\n        barmode='stack',\n        hovermode=\"x\"\n    )\n \nfig.show()\n```\n\nAccording to the graph above, as the Covd-19 vaccination rates increases, the prevalence of new cases is drastically low, indicating the effectiveness of Covd-19 in mitigating the severe impacts of the pandemic.\n\n# Conclusion \n\nThe hypothesis H0 = Covid-19 vaccines has an reduced the deathrates related to Covid-19 infection is true \nAccording to the graphh below, although Covid-19 Cases were increasing, the more the people got vaccinated, led to a reduction in death-rates. \n\nHowever, vaccines were not the only contributing factor to mitigating the fatalities of the pandemic. The national lockdowns, quarrantines and wearing of masks and community hygiene also played a pivotal role.\n\n\n# Call to Action \nVaccines have proven to be quite effective in harnessing pandemics, However the inception faces a lot resistance from the public, therefore more awareness programs should be put in place so that acceptance is high and fatalities are reduced. \n\n\n\n\n```{python}\ntitle = fill_title_and_subtitle(\"The Race Against Covid\", \"Visualizing Cumulative Statistics of Disease vs Vaccine\")\n \nfig = go.Figure(data=[\n                go.Scatter(\n                    mode=\"lines+markers\",\n                    name=\"Total Deaths\",\n                    x=data['date'], \n                    y=data['cumulative_total_deaths'],\n                    marker_color=\"crimson\",\n                ),\n                go.Scatter(\n                    mode=\"lines+markers\",\n                    name=\"Total Cases\",\n                    x=data['date'], \n                    y=data['cumulative_total_cases'],\n                    marker_color=\"royalblue\"\n                ),\n\n                go.Scatter(\n                    mode=\"lines+markers\",\n                    name=\"Total Vaccinated\",\n                    x=data['date'], \n                     y=data['daily_vaccinations'],\n                    marker_color=\"lightseagreen\"\n                ),\n            ])\n \nfig.update_layout(\n        title = title,\n        xaxis_title=\"\",\n        yaxis_title=\"Count\",\n        hovermode=\"x\",\n    legend_orientation='h'\n)\nfig.show()\n```\n\n\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"jupyter"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"number-sections":true,"output-file":"main_analysis.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.1.189","theme":"cosmo","title":"Main Analysis","jupyter":"python3"},"extensions":{"book":{"multiFile":true}}}}}